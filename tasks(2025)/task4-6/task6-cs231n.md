# Task 6 CV 入门

## 学习目的

祝贺你坚持到这里。你已经完成了前期的系统学习：在 Task 4 中，你实现了反向传播算法；在 Task 5 中，你使用模块化的方法构建了现代卷积神经网络的架构。你不再仅是调用 API 的使用者，而是真正理解神经网络内部运作机制的开发者。

现在，欢迎来到 CS231n 系列的最后阶段，也是基础学习阶段的重要总结。

在本阶段的学习中，我们将从单一的判别式（Discriminative）图像分类任务扩展到更广阔的领域。你将学习如何让模型生成（Generate）全新的数据，如何让模型结合视觉与语言进行多模态处理（Multimodal Processing），以及如何在没有人工标注的情况下进行自监督学习（Self-Supervised Learning）。

本次任务将是你从理解经典模型到接触前沿研究的过渡。完成它，意味着你将具备初步阅读顶级会议论文、理解并实现复杂 AI 系统的核心能力。

## 学习内容

本阶段你将接触到一系列定义了现代 AI 研究方向的重要模型与方法：

* 序列模型（Sequence Models）：循环神经网络（Recurrent Neural Network, RNN）与长短期记忆网络（Long Short-Term Memory, LSTM），及其在图文生成任务中的应用。
* 注意力机制与 Transformer（Attention Mechanism and Transformer）：理解驱动了当今大语言模型发展的核心——自注意力机制（Self-Attention），并将其应用于计算机视觉任务。
* 生成式模型（Generative Models）：学习并实现生成对抗网络（Generative Adversarial Networks, GANs），训练一个能生成逼真图像的模型。
* 自监督学习（Self-Supervised Learning）：学习前沿的自监督学习方法（SimCLR），了解如何在没有标签的数据上训练强大的表征模型。

## 学习要求

与前两次作业相比，本阶段任务在代码实现上的工作量可能有所减少，但对概念理解和系统整合能力的要求达到了最高水平。

1. 跨领域思维：你需要将 Task 5 中训练的 CNN 作为特征提取器（Feature Extractor），与本阶段学习的 RNN/Transformer 等序列处理器（Sequence Processor）结合起来，共同完成图文生成这一多模态任务。
2. 理解前沿方法：GAN 的博弈论思想、Transformer 的自注意力机制、SimCLR 的对比学习范式，这些都是近十年来 AI 领域的重大突破。你需要花费大量时间阅读课程笔记，甚至尝试阅读相关的经典论文（如「Attention Is All You Need」），才能真正理解其核心思想。
3. 系统级调试：你将要构建的是一个包含多个复杂组件的系统，调试的难度会显著上升。你需要更有耐心，并学会如何分模块进行测试和验证。

## 作业

关于本次的任务，你需要完成以下内容——

* 作业内容中提到的所有文档（不出意外的话是 2 份）
* 完成作业一
* 从作业二、三中选择一项完成

### 作业 1

完成 [CS231n Assignment 3](https://cs231n.github.io/assignments2025/assignment3/)

#### RNN / LSTM

在这一部分，你将构建一个能够为图片生成文字描述的模型。它会接收一张图片，并生成一段描述图片内容的文字。你需要：

* 使用一个预训练好的 CNN 模型来提取图像的特征向量。
* 实现一个基于循环神经网络（RNN）的解码器，它会接收图像特征，并逐词生成描述语句。
* 为了解决 RNN 的长期依赖问题，你将进一步实现一个基于长短期记忆网络（LSTM）的解码器，并观察其性能提升。

#### Transformer

在体验了 RNN 处理序列的模式后，你将接触到当今 AI 领域的主流方法——Transformer。你需要：

* 学习并实现自注意力机制（Self-Attention）和多头注意力（Multi-Head Attention）。
* 将 RNN 解码器替换为一个基于 Transformer 的解码器，再次完成图文生成任务，并与 LSTM 的结果进行比较。

#### 生成对抗网络（GANs）

在这一部分，你将从理解内容转向创造内容。你将实现一个 GAN，从随机噪声中生成逼真的手写数字图像。你需要：

* 分别实现一个生成器（Generator）和一个判别器（Discriminator）网络。
* 理解并实现 GAN 的交替训练过程，在生成器和判别器的对抗与博弈中，让模型学会生成越来越真实的图像。

#### 自监督学习 - SimCLR

在最后一部分，你将接触到一种强大的无监督学习方法，它使得在海量无标签数据上预训练模型成为可能。你需要：

* 理解对比学习（Contrastive Learning）的核心思想。
* 实现 SimCLR 的关键组件，如数据增强、投影头和 NT-Xent 损失函数。

#### 作业 1 - 作业要求

在完成作业后，你需要写一份**文档**，内容包括但不限于：

1. 各个模型的实现细节与数学原理
2. 各个模型在图文生成、图像生成、自监督学习任务上的性能比较与分析
3. 你在实现过程中遇到的挑战与解决方案

#### 作业参考资料

1. [跟李沐学AI 54 循环神经网络 RNN【动手学深度学习v2】](https://www.bilibili.com/video/BV1D64y1z7CA/?spm_id_from=333.337.search-card.all.click&vd_source=0272bb7dd0d8d9302c55fc082442b9e3)

2. [跟李沐学AI 57 长短期记忆网络（LSTM）【动手学深度学习v2】](https://www.bilibili.com/video/BV1JU4y1H7PC?spm_id_from=333.788.recommend_more_video.4&vd_source=0272bb7dd0d8d9302c55fc082442b9e3)

3. [跟李沐学AI GAN论文逐段精读【论文精读】](https://www.bilibili.com/video/BV1rb4y187vD/?spm_id_from=333.337.search-card.all.click&vd_source=0272bb7dd0d8d9302c55fc082442b9e3)

4. [跟着李沐学AI Transformer论文逐段精读【论文精读】](https://www.bilibili.com/video/BV1pu411o7BE/?spm_id_from=333.337.search-card.all.click&vd_source=0272bb7dd0d8d9302c55fc082442b9e3)

5. [自监督式学习](https://www.bilibili.com/video/BV1m3411p7wD?spm_id_from=333.788.videopod.episodes&vd_source=0272bb7dd0d8d9302c55fc082442b9e3&p=46)

6. [【Transformer 其实是个简单到令人困惑的模型【白话DeepSeek-06】](https://www.bilibili.com/video/BV1C3dqYxE3q/?share_source=copy_web&vd_source=3fbbb3c2ad24817002f9c39fad247a3b)

7. [68 Transformer【动手学深度学习v2】](https://www.bilibili.com/video/BV1Kq4y1H7FL/?p=2&share_source=copy_web&vd_source=3fbbb3c2ad24817002f9c39fad247a3b)

### 作业 2：迁移学习与特征可视化

在 Task 5 中，你从零开始训练了一个卷积神经网络。你可能发现：为了提高一点点准确率，需要调参很久，而且训练非常耗时。

在现实世界中，我们很少从零开始训练，因为像 Google、Facebook 这样的巨头已经用数百万张图片训练好了极其强大的模型。

本次作业，你将学习如何用极少的数据、极短的时间，训练出一个高精度的分类器。

同时，你有没有考虑过 CNN 在学习过程中到底学到了什么，它是如何理解图像的？

我们将切开这些模型，看看它们的大脑里到底长什么样。

> 本作业禁止使用 timm 等高级库，你需要使用 torchvision.models 加载模型，并手动操作网络层和权重。

#### 迁移学习

我们将使用一个在 ImageNet 上预训练好的 ResNet-18，来解决 CIFAR-10（或你自定义的小数据集）分类问题。

你需要完成以下步骤：

1. 加载预训练模型：
    1. 使用 torchvision.models.resnet18(pretrained=True)。
    2. 下载下来的模型权重文件有多大？
2. 冻结骨干网络：
    1. 这是一个非常重要的技巧。你需要遍历模型的前面大部分层，将它们的参数设置为 param.requires_grad = False。
    2. 我们在训练时，不更新这些层提取特征的能力（因为它们已经很强了），只训练最后的分类器。
3. 修改分类头：
    1. ImageNet 有 1000 类，而 CIFAR-10 只有 10 类。
    2. 你需要将 ResNet 最后一层全连接层 (model.fc) 替换为一个新的、输入维度不变、输出维度为 10 的全连接层。
    3. 注意，新加的层，默认 requires_grad=True。
4. 训练与对比：
    1. 在 CIFAR-10 上训练这个微调后的模型 5 个 Epoch。
    2. 对比从零训练的 ResNet 与预训练微调的 ResNet 在收敛速度和最终准确率上的差异。

> 注意，ResNet-18 默认输入尺寸为 224x224，所以请思考是否需要对 CIFAR-10 的图片或你自己收集的图片进行调整。
>
> 可以参考 transforms.Resize

#### 特征可视化

CNN 的卷积层会输出一系列的特征图。

你需要编写代码（使用 PyTorch 的 hook 机制或直接前向传播到中间层），来展示：

1. 浅层特征：提取第一层卷积 (conv1) 的输出。
    * 预期效果：你会看到边缘、纹理、颜色等基础特征。
2. 深层特征：提取最后一层卷积 (layer4) 的输出。
    * 预期效果：你会看到更加抽象、模糊的特征，这些特征代表了猫的耳朵、车的轮子等高级语义。

任务要求：

1. 找一张图片
2. 将它输入模型。
3. 用 matplotlib 画出它在第一层和最后一层的特征图

#### 作业 2 - 作业要求

在完成作业后，你需要写一份**文档**，内容包括但不限于：

1. 迁移学习的实验设计与实现细节
2. 迁移学习与从零训练的性能比较与分析
3. 特征可视化的结果展示与分析

### 作业 3：数学建模 - 2025 电工杯 A 题（的问题 3）

在完成了前两部分的作业后，你已经对这道题有了深入的认识。

此前，我们的数据只是时间序列以及光伏发电量，现在，依据题目的要求，我们引入天气数据，尝试提升预测的准确率。

题目原文如下：

```txt
问题 3：建立融入 NWP 信息的光伏电站日前发电功率预测模型

建立融入 NWP 信息的光伏电站日前发电功率预测模型，进行发电功率预测，根据预测结果，分析评价融入 NWP 信息能否有效提高预测精度；若可以，请给出提高预测精度的场景划分方案，并进行验证。
```

#### 数据收集以及清洗

NWP 指的是数值天气预报（Numerical Weather Prediction），请使用[Open-Meteo](https://open-meteo.com/en/docs/historical-weather-api)获取经度：-122.17022，纬度：37.42673 的历史天气数据，时间范围为 2017-01-01 至 2017-12-31。

如果你之前使用的不是斯坦福大学提供的数据集，你也可以自行修改经度和纬度，获取你使用的数据集对应地点的天气数据。

如果你有更好的方式获取天气数据，也可以使用其他方式。

你应该自行思考需要获取哪些天气数据，例如温度、湿度、风速、云量等。

在下载天气数据后，你需要对数据进行清洗以及归一化，确保数据的完整性和一致性。你可以参考 Task 4 中的数据清洗方法。

#### 引入深度学习

此前我们使用的是传统的机器学习方法，例如 LR，SVR，RF，XGBoost等。

现在，我们要在引入天气数据的基础上，使用深度学习的方法进行预测。

引入 RNN，LSTM，Transformer，并使用此前提到的所有方法，比较它们的预测效果，并进行误差分析，可视化等。

思考以下问题：

1. 如何将时间序列数据与天气数据进行融合输入模型？
2. 不同模型在处理多模态数据时的表现有何差异？
3. 深度学习方法是否显著优于传统机器学习方法？
4. LSTM 常用于处理序列数据（如文本、语音），并在 CV 的图文生成任务中充当解码器，为什么这里也能使用 LSTM 进行时间序列预测？
5. Transformer 的自注意力机制在时间序列预测中有何优势？
6. 在当前数据集下，Transformer 是否优于 RNN/LSTM？

然后阅读以下内容（题目原文放在最后）：

> 这道题不需要你完成，你只需要阅读并思考以下问题即可。

背景：无人机需要投放烟幕弹来掩护地面目标，防止被敌方导弹锁定。

已知条件：

1. 明确的物理规律：烟幕弹在重力作用下运动，起爆后形成半径 10m 的云团，以 3m/s 速度匀速下沉。
2. 明确的几何关系：导弹位置、无人机位置、保护目标位置已知。
3. 明确的目标：通过调整投放时间、速度和角度，使得烟幕遮蔽时间最大化。

> 请翻到最后阅读一遍原题目后再回答，而不是只看上面的摘要。
>
> 只看上面的摘要会给人一种错觉，认为这是一道明确的物理建模题目，但是事实上如果你阅读完整题目，你会发现：
>
> 这道题目虽然基于明确的物理规律，但由于涉及多智能体协同和多目标优化，难以单纯通过推导物理公式得到解析解。它更像是一个在物理约束下的复杂组合优化问题。

基于上述背景、已知条件和你学过的知识，思考以下问题：

1. 深度学习一定比传统机器学习方法好吗？为什么？
2. 更复杂的模型一定更好吗？为什么？
3. 在实际的应用中，如何取舍时间成本与性能提升？
4. 对于这道题目，你认为可以使用机器学习/深度学习的方法来解决吗？为什么？
5. 如果可以使用机器学习/深度学习的方法来解决，你会如何设计模型？使用哪些数据？为什么？
6. 如果不可以使用机器学习/深度学习的方法来解决，你认为传统的方法中，哪些方法更适合解决这道题目？为什么？

#### 作业 3 - 作业要求

在完成作业后，你需要写一份**文档**，内容包括但不限于：

1. 综合考虑 Task 4-6 的所有改进方法后的最终模型设计
2. 对上述关于光伏预测 vs 烟幕弹投放的思考。
3. 展示 NWP 引入后的效果，以及深度学习模型的训练曲线。

以及你遇到的问题，等等。

#### 国赛 2025 A 题原文

2025 高教社杯 A 题 - 烟幕干扰弹的投放策略

烟幕干扰弹主要通过化学燃烧或爆炸分散形成烟幕或气溶胶云团，在目标前方特定空域形成遮蔽，干扰敌方导弹，具有成本低、效费比高等优点。随着烟幕干扰技术的不断发展，现已有多种投放方式完成烟幕干扰弹的定点精确抛撒，即在抛撒前能精确控制烟幕干扰弹到达预定位置，通过时间引信时序控制起爆时间。

现考虑运用无人机完成烟幕干扰弹的投放策略问题。具有长续航能力的无人机挂载某型烟幕干扰弹在特定空域巡飞，受领任务后，无人机投放烟幕干扰弹在来袭武器和保护目标之间形成烟幕遮蔽。每架无人机投放两枚烟幕干扰弹至少间隔1  s。烟幕干扰弹脱离无人机后，在重力作用下运动。烟幕干扰弹起爆后瞬时形成球状烟幕云团，由于采用特定技术，该烟幕云团以 3 m/s 的速度匀速下沉。据试验数据知，云团中心 10 m 范围内的烟幕浓度在起爆 20 s 内可为目标提供有效遮蔽。

来袭武器为空地导弹，该型导弹飞行速度300 m/s。导弹的飞行方向直指一个为掩护某半径7 m、高10 m的圆柱形固定目标而专门设置的假目标。以假目标为原点，水平面为 𝑥𝑦 平面，真目标下底面的圆心为 (0,200,0)。警戒雷达发现来袭导弹时，3 枚导弹 M1、M2、M3分别位于 (20000,0,2000)、(19000,600,2100)、(18000,−600,1900)；5 架无人机的位置信息分别为 FY1(17800,0,1800)、FY2(12000,1400,1400)、FY3(6000,−3000,700)、FY4(11000,2000,1800)、FY5(13000,−2000,1300)。

在导弹来袭过程中，通过投放烟幕干扰弹尽量避免来袭导弹发现真目标。控制中心在警戒雷达发现目标时，立即向无人机指派任务。无人机受领任务后，可根据需要瞬时调整飞行方向，然后以70~140 m/s的速度等高度匀速直线飞行。每架无人机的航向、速度可不相同，但一旦确定就不再调整。

为实现更为有效的烟幕干扰效果，需设计烟幕干扰弹的投放策略，主要包括无人机飞行方向、飞行速度、烟幕干扰弹投放点、烟幕干扰弹起爆点等。请建立数学模型，针对不同情形，分别设计烟幕干扰弹的投放策略，使得多枚烟幕干扰弹对真目标的有效遮蔽时间尽可能长。不同烟幕干扰弹的遮蔽可不连续。

问题1  利用无人机FY1投放1枚烟幕干扰弹实施对M1的干扰，若FY1以120 m/s的
速度朝向假目标方向飞行，受领任务1.5 s后即投放1枚烟幕干扰弹，间隔3.6 s后起爆。请给出烟幕干扰弹对M1的有效遮蔽时长。

问题2  利用无人机FY1投放1枚烟幕干扰弹实施对M1的干扰，确定FY1的飞行方
向、飞行速度、烟幕干扰弹投放点、烟幕干扰弹起爆点，使得遮蔽时间尽可能长。

问题3  利用无人机FY1投放3枚烟幕干扰弹，实施对M1的干扰。请给出烟幕干扰弹的投放策略，并将结果保存到文件result1.xlsx中（模板文件见附件）。

问题4  利用FY1、FY2、FY3等3架无人机，各投放1枚烟幕干扰弹，实施对M1的
干扰。请给出烟幕干扰弹的投放策略，并将结果保存到文件 result2.xlsx 中（模板文件见附件）。

问题5  利用5架无人机，每架无人机至多投放3枚烟幕干扰弹，实施对M1、M2、M3等3枚来袭导弹的干扰。请给出烟幕干扰弹的投放策略，并将结果保存到文件result3.xlsx中（模板文件见附件）。
